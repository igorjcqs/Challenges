<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y="
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/material-design-icons/3.0.1/iconfont/material-icons.min.css"
      integrity="sha256-x8PYmLKD83R9T/sYmJn1j3is/chhJdySyhet/JuHnfY="
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/styles/dash.css" />
  </head>

  <body onload="insertData()">
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-mattBlackLight fixed-top"
    >
      <button class="navbar-toggler sideMenuToggler" type="button">
        <span class="navbar-toggler-icon"></span>
      </button>

      <a class="navbar-brand" href="/">Martins Websites</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
    </nav>
    <div class="wrapper d-flex">
      <div class="sideMenu bg-mattBlackLight">
        <div class="sidebar">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a href="/dashboard/user" class="nav-link px-2">
                <i class="material-icons icon"> person </i>
                <span class="text">Manage profile</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="/dashboard/createproduct" class="nav-link px-2">
                <i class="material-icons icon"> local_mall </i>
                <span class="text">Create product</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="/dashboard/editproduct" class="nav-link px-2">
                <i class="material-icons icon"> edit </i>
                <span class="text">Edit product</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link px-2 active">
                <i class="material-icons icon active"> local_offer </i>
                <span class="text">Manage discounts</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div class="content">
        <div class="content">
          <main>
            <div class="container mt-5 ml-5">
              <h1>Discounts</h1>
              <table
                id="example"
                class="table table-striped table-bordered"
                style="width: 100%"
              >
                <thead>
                  <tr>
                    <th>Id</th>
                    <th>Product</th>
                    <th>New price</th>
                    <th>Old price</th>
                    <th>Created by</th>
                    <th>Delete</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </main>
        </div>
      </div>
    </div>
    <script>
      function firstUpper(name) {
        return name.charAt(0).toUpperCase() + name.slice(1);
      }

      function titleCase(str) {
        var splitStr = str.toLowerCase().split(" ");
        for (var i = 0; i < splitStr.length; i++) {
          splitStr[i] =
            splitStr[i].charAt(0).toUpperCase() + splitStr[i].substring(1);
        }
        return splitStr.join(" ");
      }

      async function insertData() {
        const table = document.querySelector("tbody");
        const res = await fetch("/discounts/all");
        const data = await res.json();

        if (data) {
          for (const row of data.products) {
            for (var i = 0; i < 1; i++) {
              var newColunm = table.insertRow(i);
              var idCell = newColunm.insertCell(0);
              var productCell = newColunm.insertCell(1);
              var newPriceCell = newColunm.insertCell(2);
              var oldPriceCell = newColunm.insertCell(3);
              var createdBy = newColunm.insertCell(4);
              var removeCell = newColunm.insertCell(5);
              idCell.innerHTML = `<div>${row._id}</div>`;
              productCell.innerHTML = `<a href="/product/find/${
                row.productId
              }">${firstUpper(row.productName)}</a>`;
              newPriceCell.innerHTML = row.newPrice;
              oldPriceCell.innerHTML = row.oldPrice;
              createdBy.innerHTML = row.createdBy;
              removeCell.innerHTML = `<div class="text-center"><button onclick="deleteThis()" id="deleteButton" class="${row._id}"><i class="material-icons icon delete"> delete </i></button></div>`;
            }
          }
        }
      }
    </script>
    <script>
      async function deleteThis() {
        const discountId = document.getElementById("deleteButton").className;
        const res = await fetch("/discounts/delete/" + discountId, {
          method: "DELETE",
        });
        if (res.status == 200) {
          location.assign("/dashboard/discounts");
        }
      }
    </script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.bundle.min.js"
      integrity="sha256-OUFW7hFO0/r5aEGTQOz9F/aXQOt+TwqI1Z4fbVvww04="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jQuery-slimScroll/1.3.8/jquery.slimscroll.min.js"
      integrity="sha256-qE/6vdSYzQu9lgosKxhFplETvWvqAAlmAuR+yPh/0SI="
      crossorigin="anonymous"
    ></script>
  </body>
</html>
