<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y="
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/material-design-icons/3.0.1/iconfont/material-icons.min.css"
      integrity="sha256-x8PYmLKD83R9T/sYmJn1j3is/chhJdySyhet/JuHnfY="
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/styles/dash.css" />
  </head>

  <body onload="prepare()">
    <div id="secretAvatarURL" style="display: none">{{user.avatar}}</div>
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-mattBlackLight fixed-top"
    >
      <button class="navbar-toggler sideMenuToggler" type="button">
        <span class="navbar-toggler-icon"></span>
      </button>

      <a class="navbar-brand" href="/">Martins Websites</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
    </nav>
    <div class="wrapper d-flex">
      <div class="sideMenu bg-mattBlackLight">
        <div class="sidebar">
          <ul class="navbar-nav">
            <li class="nav-item active">
              <a class="nav-link px-2 active">
                <i class="material-icons icon"> person </i>
                <span class="text">Manage profile</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="/dashboard/createproduct" class="nav-link px-2">
                <i class="material-icons icon"> local_mall </i>
                <span class="text">Create product</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="/dashboard/editproduct" class="nav-link px-2">
                <i class="material-icons icon"> edit </i>
                <span class="text">Edit product</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="/dashboard/discounts" class="nav-link px-2">
                <i class="material-icons icon"> local_offer </i>
                <span class="text">Manage discounts</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div class="content">
        <main>
          <div class="container">
            <br />
            <br />
            <br />
            <div class="row">
              <div
                class="col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4"
              >
                <div
                  class="profile-card card rounded-lg shadow p-4 p-xl-5 mb-4 text-center position-relative overflow-hidden"
                >
                  <div id="avatarImageID">
                    <form
                      method="post"
                      action="/user/images/"
                      enctype="multipart/form-data"
                      id="avatarImageForm"
                      name="avatarImageForm"
                    >
                      <input type="file" name="imageUploadField" id="avatar" />
                    </form>
                    <img
                      src="/assets/user1.jpg"
                      id="mainImage"
                      class="img-circle mx-auto mb-3"
                    />
                  </div>
                  <h3 class="mb-1">{{ userFirstName }} {{ userLastName }}</h3>
                  <p class="mb-4" id="userId">{{user.id}}</p>
                  <div class="text-left mb-4">
                    <p class="mb-2">
                      <i class="fa fa-envelope mr-2"></i>
                      {{ user.email }}
                    </p>
                    <p class="mb-2">
                      <i class="fa fa-map-marker-alt mr-2"></i> Brasil
                    </p>
                  </div>
                  <div class="social-links d-flex justify-content-center">
                    <button class="btn delAccount" id="deleteAccountButton">
                      Delete your account
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
    <script>
      const userId = document.getElementById("userId").textContent;

      function prepare() {
        document
          .getElementById("avatarImageForm")
          .setAttribute("action", "/user/images/" + userId);
        const mainImage = document.getElementById("mainImage");
        const imageLink = document.getElementById("secretAvatarURL").innerHTML;

        if (imageLink) {
          mainImage.src = imageLink;
        }
      }
    </script>
    <script>
      document
        .getElementById("avatarImageID")
        .addEventListener("click", uploadImage);

      async function uploadImage() {
        document.getElementById("avatar").click();
        const inter = setInterval(() => {
          if (document.getElementById("avatar").files.length == 1) {
            clearInterval(inter);
            document.avatarImageForm.submit();
          }
        }, 1000);
      }
    </script>
    <script>
      document
        .getElementById("deleteAccountButton")
        .addEventListener("click", deleteUser);

      async function deleteUser() {
        var res = await fetch("/user/delete", {
          method: "DELETE",
        });
        const data = await res.json();
        if (data.message == "User deleted.") {
          location.assign("/");
        }
      }
    </script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.bundle.min.js"
      integrity="sha256-OUFW7hFO0/r5aEGTQOz9F/aXQOt+TwqI1Z4fbVvww04="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jQuery-slimScroll/1.3.8/jquery.slimscroll.min.js"
      integrity="sha256-qE/6vdSYzQu9lgosKxhFplETvWvqAAlmAuR+yPh/0SI="
      crossorigin="anonymous"
    ></script>
  </body>
</html>
