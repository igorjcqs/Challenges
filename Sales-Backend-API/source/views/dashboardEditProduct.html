<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y="
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/material-design-icons/3.0.1/iconfont/material-icons.min.css"
      integrity="sha256-x8PYmLKD83R9T/sYmJn1j3is/chhJdySyhet/JuHnfY="
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/v/dt/dt-1.11.3/datatables.min.css"
    />
    <link rel="stylesheet" href="/styles/dash.css" />
  </head>

  <body onload="insertData()">
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-mattBlackLight fixed-top"
    >
      <button class="navbar-toggler sideMenuToggler" type="button">
        <span class="navbar-toggler-icon"></span>
      </button>

      <a class="navbar-brand" href="/">Martins Websites</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle p-0"
              href="#"
              id="navbarDropdown"
              role="button"
              data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
            >
              <i class="material-icons icon"> person </i>
            </a>
            <div
              class="dropdown-menu dropdown-menu-right"
              aria-labelledby="navbarDropdown"
            >
              <a class="dropdown-item" href="#">Action</a>
              <a class="dropdown-item" href="#">Another action</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="#">Something else here</a>
            </div>
          </li>
        </ul>
      </div>
    </nav>
    <div class="wrapper d-flex">
      <div class="sideMenu bg-mattBlackLight">
        <div class="sidebar">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a href="/dashboard/user" class="nav-link px-2">
                <i class="material-icons icon"> person </i>
                <span class="text">User Profile</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="/dashboard/createproduct" class="nav-link px-2">
                <i class="material-icons icon"> dashboard </i>
                <span class="text">Create Product</span>
              </a>
            </li>
            <li class="nav-item active">
              <a class="nav-link px-2 active">
                <i class="material-icons icon"> edit </i>
                <span class="text">Edit Product</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div class="content">
        <main>
          <div class="container mt-5 ml-5">
            <h1>Edit a product</h1>
            <table
              id="example"
              class="table table-striped table-bordered"
              style="width: 100%"
            >
              <thead>
                <tr>
                  <th>Id</th>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Price</th>
                  <th>Size</th>
                  <th>Color</th>
                  <th>Material</th>
                  <th>Section</th>
                  <th>Stock</th>
                  <th>Creator</th>
                  <th>Image</th>
                  <th>Edit</th>
                  <th>Remove</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </main>
      </div>
    </div>
    <script>
      function firstLetterToUpperCase(name) {
        return name.charAt(0).toUpperCase() + name.slice(1);
      }

      function titleCase(str) {
        var splitStr = str.toLowerCase().split(" ");
        for (var i = 0; i < splitStr.length; i++) {
          splitStr[i] =
            splitStr[i].charAt(0).toUpperCase() + splitStr[i].substring(1);
        }
        return splitStr.join(" ");
      }

      async function insertData() {
        const table = document.querySelector("tbody");
        const res = await fetch("/dashboard/showproducts");
        const data = await res.json();

        if (data) {
          for (const row of data.products) {
            for (var i = 0; i < 1; i++) {
              var newColunm = table.insertRow(i);
              var idCell = newColunm.insertCell(0);
              var nameCell = newColunm.insertCell(1);
              var descCell = newColunm.insertCell(2);
              var priceCell = newColunm.insertCell(3);
              var sizeCell = newColunm.insertCell(4);
              var colorCell = newColunm.insertCell(5);
              var materialCell = newColunm.insertCell(6);
              var sectionCell = newColunm.insertCell(7);
              var stockCell = newColunm.insertCell(8);
              var creatorCell = newColunm.insertCell(9);
              var imageCell = newColunm.insertCell(10);
              var editCell = newColunm.insertCell(11);
              var removeCell = newColunm.insertCell(12);
              idCell.innerHTML = `<div id="productIdField">${row._id}</div>`;
              nameCell.innerHTML = `<a href="/product/${
                row._id
              }">${firstLetterToUpperCase(row.name)}</a>`;
              descCell.innerHTML = row.description;
              priceCell.innerHTML = "R$" + row.price;
              colorCell.innerHTML = firstLetterToUpperCase(row.color);
              sizeCell.innerHTML = row.size;
              materialCell.innerHTML = firstLetterToUpperCase(row.material);
              sectionCell.innerHTML = firstLetterToUpperCase(row.section);
              stockCell.innerHTML = row.stock;
              creatorCell.innerHTML = titleCase(row.createdBy);
              imageCell.innerHTML = `<div class="text-center"><a href="/product/images/${row._id}" style="cursor: pointer;"><i class="material-icons icon image"> image </i></a></div>`;
              editCell.innerHTML = `<div class="text-center"><a href="/product/edit/${row._id}" style="cursor: pointer;"><i class="material-icons icon edit"> edit </i></a></div>`;
              removeCell.innerHTML = `<div class="text-center"><a href="/product/delete/${row._id}" style="cursor: pointer;"><i class="material-icons icon delete"> delete </i></a></div>`;
            }
          }
        }
      }
    </script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.bundle.min.js"
      integrity="sha256-OUFW7hFO0/r5aEGTQOz9F/aXQOt+TwqI1Z4fbVvww04="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jQuery-slimScroll/1.3.8/jquery.slimscroll.min.js"
      integrity="sha256-qE/6vdSYzQu9lgosKxhFplETvWvqAAlmAuR+yPh/0SI="
      crossorigin="anonymous"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.datatables.net/v/dt/dt-1.11.3/datatables.min.js"
    ></script>
  </body>
</html>
