<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Create discount</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y="
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/material-design-icons/3.0.1/iconfont/material-icons.min.css"
      integrity="sha256-x8PYmLKD83R9T/sYmJn1j3is/chhJdySyhet/JuHnfY="
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/styles/dash.css" />
  </head>
  <body>
       <main>
          <div id="mainContainer" class="container mt-5">
            <h1>Create discount - {{product.name}}</h1>
            <h2 id="oldPrice"> Current price: R${{product.price}} </h2>
            <div class="col mt-2">
              <div class="errortext text-center" id="errorMessageDiv">
                <p class="errorMessage mb-2" id="errorMessageText">a</p>
              </div>
              <form
                method="post"
                enctype="multipart/form-data"
              >
                <div class="form-group mb-3">
                  <label for="productName">New price</label>
                  <input type="number" name="productDiscountPrice" id="productDiscountPrice" class="form-control" />
                </div>
                <div class="button text-center">
                  <input type="submit" class="btn btn-class"></input>
                </div>
              </form>
            </div>
          </div>
        </main>
    <script>
      const form = document.querySelector("form");
      const productId = document.URL.split("/")[5];

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        var discountPrice = form.productDiscountPrice.value;

        try {
          const res = await fetch("/discounts/create/" + productId, {
            method: "POST",
            body: JSON.stringify({
              productId,
              discountPrice,
            }),
            headers: { "Content-Type": "application/json" },
          });

          if(res.status == 201) {
            location.assign('/dashboard/discounts')
          }
        } catch (err) {
          console.log(err);
        }
      });
    </script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.bundle.min.js"
      integrity="sha256-OUFW7hFO0/r5aEGTQOz9F/aXQOt+TwqI1Z4fbVvww04="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jQuery-slimScroll/1.3.8/jquery.slimscroll.min.js"
      integrity="sha256-qE/6vdSYzQu9lgosKxhFplETvWvqAAlmAuR+yPh/0SI="
      crossorigin="anonymous"
    ></script>
  </body>
</html>
